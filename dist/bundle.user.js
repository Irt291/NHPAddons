// ==UserScript==
// @name         NHP WEB
// @match        *://*.nhpoj.net/*
// @grant        none
// @version      6.9
// @author       Irt291
// @run-at       document-idle
// @description  làm màu cho /user-home; fix SEB contest
// ==/UserScript==

(()=>{var e=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};let i=t=>e(void 0,void 0,void 0,function*(){for(;null===document.querySelector(t);)yield new Promise(t=>requestAnimationFrame(t));return document.querySelector(t)}),o=e=>new Promise(t=>setTimeout(t,e));function r(t){t=("; "+document.cookie).split(`; ${t}=`);if(2===t.length)return t.pop().split(";").shift()}var c=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};let a="#ed4014",u="#2b7dff",s="#19be6b",l="#ffa410",d=()=>document.getElementsByName("NHP-FAKE-BUTTON"),f=()=>+window.location.href.split("/").at(-1);function h(t,e){return c(this,void 0,void 0,function*(){return!0===(yield(yield fetch("/api/contest/password",{method:"POST",body:JSON.stringify({password:e,contest_id:t}),headers:{"X-CSRFToken":r("csrftoken"),"Content-Type":"application/json; charset=utf-8"}})).json()).data})}function v(e,n){i(".NHP-STATUS-PLACEHOLDER").then(t=>{t.style.color=n,t.textContent=e})}function p(){return c(this,void 0,void 0,function*(){v("Đang Đăng Nhập...",u);var t=f(),e=yield i(".ivu-input"),n=e.value;(yield h(t,n))||(yield h(t,atob("TkhQU0VC")+n))?(v("ĐĂNG NHẬP THÀNH CÔNG!",s),yield o(800),v("(Đã Đăng Nhập)",u),function(n){c(this,void 0,void 0,function*(){n.parentElement.removeChild(n);for(var t=(yield i("div.ivu-card-body:nth-child(1) > ul:nth-child(1)")).children,e=0;e<t.length;e++)t[e].className=""})}(e.parentElement.parentElement)):(v("SAI MẬT KHẨU!",a),yield o(800),v("(Chưa Đăng Nhập)",l))})}function n(){return c(this,void 0,void 0,function*(){let n=yield function(t){return c(this,void 0,void 0,function*(){return(yield(yield fetch("/api/contest/access?contest_id="+t,{method:"GET",headers:{"X-CSRFToken":r("csrftoken"),"Content-Type":"application/json; charset=utf-8"}})).json()).data.access})}(f());i(".panel-title").then(t=>{var e=document.createElement("b");e.className="NHP-STATUS-PLACEHOLDER",n?v("(Đã Đăng Nhập)",s):v("(Chưa Đăng Nhập)",l),t.appendChild(e)}),n||i(".contest-password").then(t=>{var e,n,o;d().length<1&&(document.querySelector(".ivu-btn-info").remove(),e="Let him cook!",n=6,(o=document.createElement("button")).setAttribute("class","ivu-btn ivu-btn-info"),o.innerText=e,o.type="button",o.name="NHP-FAKE-BUTTON",o.style.right=n+"%",o.style.transform=`translateX(${n}%)`,(e=o).addEventListener("click",p),t.appendChild(e))})})}var y=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};let m=0,b=1,w=2,T=3,C=4,N=5,g=6,S=7,E=8,k=-2,P=-1,x="#19be6b",H="#19be6b",A="#ed4014",L="#ed4014",F="#2db7f5",j="#2db7f5",R="#f90",_="#f90";let G="#e0e0e0";function O(t,e,n){t.lastChild.style.color="#ffffff",t.style.borderColor=n,t.style.background=e}function U(t,e){for(var n=0;n<e.children.length;n++){var o=e.children[n].firstChild,i=(o.style.backgroundColor=G,o.textContent.trim()),r=function(t,e){for(var n in t){n=t[n];if(n._id==e)return n.status}return-69}(t,i);switch(console.log(`Van De Ky Nang: ${i}   Stat: `+r),r){case m:O(o,H,x);break;case k:O(o,_,R);break;case g:case S:case E:O(o,j,F);break;case C:case b:case P:case N:case T:case w:O(o,L,A)}}}function K(){return y(this,void 0,void 0,function*(){i("#problems").then(o=>{i(".drop-menu-title > span:nth-child(1)").then(t=>{!function(t){return y(this,void 0,void 0,function*(){return(yield(yield fetch("/api/profile?username="+t,{method:"GET",headers:{"Content-Type":"application/json; charset=UTF-8","X-CSRFToken":r("csrftoken")}})).json()).data.oi_problems_status.problems})}(t.textContent).then(t=>{var[,e,,n]=o.children;U(t,e),U(t,n)})})})})}var t=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};function q(){return t(this,void 0,void 0,function*(){console.log("NHP Fix by Irt291 Loaded!");var t=window.location.href.split("://").at(1);t.match(/^nhpoj\.net\/contest\/\d+$/)&&(yield n()),t.includes("user-home")&&(yield K())})}window.addEventListener("load",q);let X=history.pushState;history.pushState=function(){X.apply(history,arguments),q()},window.onload=function(){let t=document.location.href;var e=document.querySelector("body");new MutationObserver(()=>{t!==document.location.href&&(t=document.location.href,q())}).observe(e,{childList:!0,subtree:!0})}})();