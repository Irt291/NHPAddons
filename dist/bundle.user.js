// ==UserScript==
// @name         NHP WEB
// @match        *://*.nhpoj.net/*
// @match        *://*.ctoj.net/*
// @grant        none
// @version      9.6
// @author       Irt291
// @run-at       document-idle
// @description  làm màu cho /user-home; fix SEB contest; preview pdf cho ctoj (fuck it!)
// ==/UserScript==

(()=>{var e=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};let i=t=>e(void 0,void 0,void 0,function*(){for(;null===document.querySelector(t);)yield new Promise(t=>requestAnimationFrame(t));return document.querySelector(t)}),o=e=>new Promise(t=>setTimeout(t,e));function r(t){t=("; "+document.cookie).split(`; ${t}=`);if(2===t.length)return t.pop().split(";").shift()}var n=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};var c=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};let a="#ed4014",u="#2b7dff",l="#19be6b",d="#ffa410",s=()=>document.getElementsByName("NHP-FAKE-BUTTON"),f=()=>+window.location.href.split("/").at(-1);function h(t,e){return c(this,void 0,void 0,function*(){return!0===(yield(yield fetch("/api/contest/password",{method:"POST",body:JSON.stringify({password:e,contest_id:t}),headers:{"X-CSRFToken":r("csrftoken"),"Content-Type":"application/json; charset=utf-8"}})).json()).data})}function p(e,n){i(".NHP-STATUS-PLACEHOLDER").then(t=>{t.style.color=n,t.textContent=e})}function v(){return c(this,void 0,void 0,function*(){p("Đang Đăng Nhập...",u);var t=f(),e=yield i(".ivu-input"),n=e.value;(yield h(t,n))||(yield h(t,atob("TkhQU0VC")+n))?(p("ĐĂNG NHẬP THÀNH CÔNG!",l),yield o(800),p("(Đã Đăng Nhập)",u),function(n){c(this,void 0,void 0,function*(){n.parentElement.removeChild(n);for(var t=(yield i("div.ivu-card-body:nth-child(1) > ul:nth-child(1)")).children,e=0;e<t.length;e++)t[e].className=""})}(e.parentElement.parentElement)):(p("SAI MẬT KHẨU!",a),yield o(800),p("(Chưa Đăng Nhập)",d))})}function y(){return c(this,void 0,void 0,function*(){let n=yield function(t){return c(this,void 0,void 0,function*(){return(yield(yield fetch("/api/contest/access?contest_id="+t,{method:"GET",headers:{"X-CSRFToken":r("csrftoken"),"Content-Type":"application/json; charset=utf-8"}})).json()).data.access})}(f());i(".panel-title").then(t=>{var e=document.createElement("b");e.className="NHP-STATUS-PLACEHOLDER",n?p("(Đã Đăng Nhập)",l):p("(Chưa Đăng Nhập)",d),t.appendChild(e)}),n||i(".contest-password").then(t=>{var e,n,o;s().length<1&&(document.querySelector(".ivu-btn-info").remove(),e="Let him cook!",n=6,(o=document.createElement("button")).setAttribute("class","ivu-btn ivu-btn-info"),o.innerText=e,o.type="button",o.name="NHP-FAKE-BUTTON",o.style.right=n+"%",o.style.transform=`translateX(${n}%)`,(e=o).addEventListener("click",v),t.appendChild(e))})})}var m=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};let b=0,w=1,C=2,T=3,g=4,N=5,S=6,E=7,x=8,P=-2,k=-1,A="#19be6b",H="#19be6b",L="#ed4014",j="#ed4014",F="#2db7f5",R="#2db7f5",$="#f90",_="#f90";let G="#e0e0e0";function O(t,e,n){t.lastChild.style.color="#ffffff",t.style.borderColor=n,t.style.background=e}function U(t,e){for(var n=0;n<e.children.length;n++){var o=e.children[n].firstChild,i=(o.style.backgroundColor=G,o.textContent.trim()),r=function(t,e){for(var n in t){n=t[n];if(n._id==e)return n.status}return-69}(t,i);switch(console.log(`Van De Ky Nang: ${i}   Stat: `+r),r){case b:O(o,H,A);break;case P:O(o,_,$);break;case S:case E:case x:O(o,R,F);break;case g:case w:case k:case N:case T:case C:O(o,j,L)}}}function K(){return m(this,void 0,void 0,function*(){i("#problems").then(o=>{i(".drop-menu-title > span:nth-child(1)").then(t=>{!function(t){return m(this,void 0,void 0,function*(){return(yield(yield fetch("/api/profile?username="+t,{method:"GET",headers:{"Content-Type":"application/json; charset=UTF-8","X-CSRFToken":r("csrftoken")}})).json()).data.oi_problems_status.problems})}(t.textContent).then(t=>{var[,e,,n]=o.children;U(t,e),U(t,n)})})})})}var t=function(t,c,a,u){return new(a=a||Promise)(function(n,e){function o(t){try{r(u.next(t))}catch(t){e(t)}}function i(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,i)}r((u=u.apply(t,c||[])).next())})};function q(){return t(this,void 0,void 0,function*(){console.log("NHP Fix by Irt291 Loaded!");var t=window.location.href.split("://").at(1);t.match(/^(nhp|ct)oj\.net\/contest\/\d+$/)&&(yield y()),t.includes("user-home")&&(yield K()),t.includes("problem/")&&(console.log(t),yield function(){return n(this,void 0,void 0,function*(){yield i("p.content:nth-child(2) > p");var e=document.querySelectorAll('a[href$=".pdf"]');for(let t=0;t<e.length;t++){var n=e[t].getAttribute("href"),o=document.createElement("object");o.data=n,o.type="application/pdf",o.width="100%",o.height="500px",e[t].parentNode.replaceChild(o,e[t])}})}())})}window.addEventListener("load",q);let X=history.pushState;history.pushState=function(){X.apply(history,arguments),q()},window.onload=function(){let t=document.location.href;var e=document.querySelector("body");new MutationObserver(()=>{t!==document.location.href&&(t=document.location.href,q())}).observe(e,{childList:!0,subtree:!0})}})();